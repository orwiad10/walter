{% extends 'base.html' %}
{% block content %}
<p><a href="{{ url_for('view_tournament', tid=m.round.tournament_id) }}">Back to Tournament</a></p>
<h2>Report Match</h2>
<p>Round {{ m.round.number }} â€” Table {{ m.table_number }}</p>
<p>
  {% if m.player2_id %}
    {{ m.player1.user.name }} vs {{ m.player2.user.name }}{% if m.player3_id %} vs {{ m.player3.user.name }}{% endif %}{% if m.player4_id %} vs {{ m.player4.user.name }}{% endif %}
  {% else %}
    {{ m.player1.user.name }} has a BYE
  {% endif %}
</p>
{% if t.format == 'Commander' %}
<form method="post">
  <table class="table center-table">
    <tbody>
      <tr>
        <td>{{ m.player1.user.name }} place</td>
        <td><input type="number" name="p1_place" min="1" max="4" value="{{ m.result.p1_place if m.result else (1 if not m.player2_id else '') }}"></td>
        <td><label><input type="checkbox" name="drop_p1"> Drop</label></td>
      </tr>
      {% if m.player2_id %}
      <tr>
        <td>{{ m.player2.user.name }} place</td>
        <td><input type="number" name="p2_place" min="1" max="4" value="{{ m.result.p2_place if m.result else '' }}"></td>
        <td><label><input type="checkbox" name="drop_p2"> Drop</label></td>
      </tr>
      {% endif %}
      {% if m.player3_id %}
      <tr>
        <td>{{ m.player3.user.name }} place</td>
        <td><input type="number" name="p3_place" min="1" max="4" value="{{ m.result.p3_place if m.result else '' }}"></td>
        <td><label><input type="checkbox" name="drop_p3"> Drop</label></td>
      </tr>
      {% endif %}
      {% if m.player4_id %}
      <tr>
        <td>{{ m.player4.user.name }} place</td>
        <td><input type="number" name="p4_place" min="1" max="4" value="{{ m.result.p4_place if m.result else '' }}"></td>
        <td><label><input type="checkbox" name="drop_p4"> Drop</label></td>
      </tr>
      {% endif %}
      <tr>
        <td colspan="3"><label><input type="checkbox" name="is_draw" {% if m.result and m.result.is_draw %}checked{% endif %}> Draw (all players)</label></td>
      </tr>
      <tr>
        <td colspan="3"><button class="btn" type="submit">Submit Result</button></td>
      </tr>
    </tbody>
  </table>
</form>
{% else %}
  {% if m.player2_id %}
  <form method="post">
    <table class="table center-table">
      <tbody>
        <tr>
          <td>{{ m.player1.user.name }} game wins</td>
          <td><input type="number" name="p1_wins" min="0" required value="{{ m.result.player1_wins if m.result else '' }}"></td>
        </tr>
        <tr>
          <td>{{ m.player2.user.name }} game wins</td>
          <td><input type="number" name="p2_wins" min="0" required value="{{ m.result.player2_wins if m.result else '' }}"></td>
        </tr>
        <tr>
          <td>Draws</td>
          <td><input type="number" name="draws" min="0" value="{{ m.result.draws if m.result else 0 }}"></td>
        </tr>
        <tr>
          <td colspan="2"><label><input type="checkbox" name="drop_p1"> Drop {{ m.player1.user.name }}</label></td>
        </tr>
        <tr>
          <td colspan="2"><label><input type="checkbox" name="drop_p2"> Drop {{ m.player2.user.name }}</label></td>
        </tr>
        <tr>
          <td colspan="2"><button class="btn" type="submit">Submit Result</button></td>
        </tr>
      </tbody>
    </table>
  </form>
  {% else %}
  <form method="post">
    <p>BYE for {{ m.player1.user.name }}</p>
    <input type="hidden" name="p1_wins" value="{{ m.result.player1_wins if m.result else 2 }}">
    <input type="hidden" name="p2_wins" value="{{ m.result.player2_wins if m.result else 0 }}">
    <input type="hidden" name="draws" value="{{ m.result.draws if m.result else 0 }}">
    <p><label><input type="checkbox" name="drop_p1"> Drop {{ m.player1.user.name }}</label></p>
    <button class="btn" type="submit">Submit Result</button>
  </form>
  {% endif %}
{% endif %}
{% endblock %}
