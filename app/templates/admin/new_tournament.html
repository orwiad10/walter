{% extends 'base.html' %}
{% block content %}
<h2>New Tournament</h2>
<form method="post">
  <table class="table center-table">
    <tbody>
      <tr>
        <td>Name</td>
        <td><input name="name" required></td>
      </tr>
      <tr>
        <td>Format</td>
        <td>
          <select name="format" id="tournament-format" required>
            <option>Commander</option>
            <option>Draft</option>
            <option>Constructed</option>
          </select>
        </td>
      </tr>
      <tr class="cube-row">
        <td>Cube Draft</td>
        <td>
          <label><input type="checkbox" name="is_cube" value="1"> Mark this draft as a cube event</label>
        </td>
      </tr>
      <tr>
        <td>Structure</td>
        <td>
          <select name="structure">
            <option value="swiss">Swiss / Cut</option>
            <option value="single_elim">Single Elimination</option>
          </select>
        </td>
      </tr>
      <tr>
        <td>Pairing Type</td>
        <td>
          {% set pairing_choice = request.form.get('pairing_type', 'swiss') %}
          <select name="pairing_type">
            <option value="swiss"{% if pairing_choice == 'swiss' %} selected{% endif %}>Swiss (standings based)</option>
            <option value="round_robin"{% if pairing_choice == 'round_robin' %} selected{% endif %}>Round Robin</option>
          </select>
        </td>
      </tr>
      <tr>
        <td>Rules Enforcement Level</td>
        <td>
          <select name="rules_enforcement_level">
            <option value="None">None</option>
            <option value="Casual">Casual</option>
            <option value="Competitive">Competitive</option>
            <option value="Professional">Professional</option>
          </select>
        </td>
      </tr>
      <tr>
        <td>Cut</td>
        <td>
          <select name="cut">
            <option value="none">None</option>
            <option value="top64">Top 64</option>
            <option value="top32">Top 32</option>
            <option value="top16">Top 16</option>
            <option value="top8">Top 8</option>
            <option value="top4">Top 4</option>
          </select>
        </td>
      </tr>
      <tr>
        <td>Commander Points (1st,2nd,3rd,4th,draw)</td>
        <td><input name="commander_points" value="3,2,1,0,1"></td>
      </tr>
      <tr>
        <td>Round Length (minutes)</td>
        <td><input type="number" name="round_length" value="50"></td>
      </tr>
      <tr>
        <td>Draft Time (minutes)</td>
        <td><input type="number" name="draft_time"></td>
      </tr>
      <tr>
        <td>Deck Build Time (minutes)</td>
        <td><input type="number" name="deck_build_time"></td>
      </tr>
      <tr>
        <td>Starting Table Number</td>
        <td><input type="number" name="start_table_number" min="1" value="{{ request.form.get('start_table_number', 1) }}"></td>
      </tr>
      <tr>
        <td>Start Time</td>
        <td><input type="datetime-local" name="start_time"></td>
      </tr>
      <tr>
        <td>Require Join Approval</td>
        <td>
          <label><input type="checkbox" name="join_requires_approval" value="1"> Require staff approval before players join</label>
        </td>
      </tr>
      <tr>
        <td colspan="2"><button class="btn" type="submit">Create</button></td>
      </tr>
    </tbody>
  </table>
</form>
<script>
const fmtSel = document.querySelector('#tournament-format');
const cutSel = document.querySelector('select[name="cut"]');
const cubeRow = document.querySelector('.cube-row');
function updateCut(){
  const top8 = cutSel.querySelector('option[value="top8"]');
  if(fmtSel.value === 'Commander'){
    top8.style.display = 'none';
    if(cutSel.value === 'top8'){ cutSel.value = 'top4'; }
  }else{
    top8.style.display = '';
  }
  if(cubeRow){
    cubeRow.style.display = fmtSel.value === 'Draft' ? '' : 'none';
  }
}
fmtSel.addEventListener('change', updateCut);
updateCut();
</script>
{% endblock %}
