{% extends 'base.html' %}
{% block content %}
<h2>Users</h2>
<form method="get" class="user-search">
  <input type="text" name="q" id="admin-user-search" value="{{ search_query }}" placeholder="Search by name or email" autocomplete="off">
  <div id="admin-user-results" class="user-lookup-results" aria-live="polite"></div>
  <button class="btn" type="submit">Search</button>
  {% if search_query %}
  <a class="btn" href="{{ url_for('admin_users') }}">Clear</a>
  {% endif %}
</form>
{% if not users %}
<p>No users found.</p>
{% else %}
<table class="table">
  <thead>
    <tr><th>Name</th><th>Email</th><th>Role</th><th></th></tr>
  </thead>
  <tbody>
    {% for u in users %}
    <tr>
      <td>{{ u.name }}</td>
      <td>{{ u.email or 'â€”' }}</td>
      <td>{{ u.role.name if u.role else 'None' }}</td>
      <td><a class="btn" href="{{ url_for('admin_user_detail', uid=u.id, q=search_query) }}">Manage</a></td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endif %}
<script>
  document.addEventListener('DOMContentLoaded', function(){
    if(window.attachUserLookup){
      window.attachUserLookup('admin-user-search', 'admin-user-results');
    }
  });
</script>
{% endblock %}
