{% extends 'base.html' %}
{% block content %}
<h2>Tournaments</h2>
<p><a class="btn" href="{{ url_for('new_tournament') }}" {% if not current_user.is_authenticated or not current_user.is_admin %}style="display:none"{% endif %}>Create Tournament</a></p>
<ul class="cards">
  {% for t in tournaments %}
    <li class="card">
      <h3><a href="{{ url_for('view_tournament', tid=t.id) }}">{{ t.name }}</a></h3>
      <div>Format: {{ t.format }}</div>
      <div>Cut: {{ t.cut|upper }}</div>
      <div>Players: {{ player_counts[t.id] }}</div>
      {% set end = t.round_timer_end or t.draft_timer_end or t.deck_timer_end %}
      {% if t.round_timer_end %}{% set ttype = 'round' %}{% elif t.draft_timer_end %}{% set ttype = 'draft' %}{% elif t.deck_timer_end %}{% set ttype = 'deck' %}{% endif %}
      {% if end %}
      <div>Timer: <span class="timer" data-timer-end="{{ end.isoformat() }}Z" data-tournament-id="{{ t.id }}" data-tournament-name="{{ t.name }}"{% if ttype %} data-timer-type="{{ ttype }}"{% endif %}></span></div>
      {% endif %}
      {% if current_user.is_authenticated and current_user.is_admin %}
      <a class="btn" href="{{ url_for('edit_tournament', tid=t.id) }}">Edit</a>
      <form method="post" action="{{ url_for('delete_tournament', tid=t.id) }}" onsubmit="return confirm('Delete this tournament?');">
        <button class="btn" type="submit">Delete</button>
      </form>
      {% endif %}
    </li>
  {% else %}
    <li>No tournaments yet.</li>
  {% endfor %}
</ul>
{% endblock %}
